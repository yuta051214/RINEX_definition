# RINEX 4.00

## 1 RINEX 3.05 から 4.00 への主な変更点

以下のリストは、現行の RINEX フォーマットバージョンと前バージョン（3.05 以前）との間で導入された主な変更点を示しています。ナビゲーションファイルは後方互換性がなくなったため、すべての RINEX ファイルにメジャーバージョン番号が割り当てられています。変更の完全な一覧はセクション 9 にあります。

### ナビゲーションファイル内の変更

- **Table A7**  
  - ヘッダー中の `LEAP SECONDS` 行を必須化（オプション扱いを廃止）  
  - `IONOSPHERIC CORR` 行を削除  
  - `TIME SYSTEM CORR` 行を削除  
  - すべてのナビゲーションメッセージに、新しいレコード先頭行を追加  

- **GPS 用 CNAV メッセージ**  
  - Table A10：GPS CNAV メッセージ定義を追加  
  - Table A11：GPS CNAV-2 メッセージ定義を追加  

- **BDS-3 用メッセージ**  
  - Table A22：BDS-3 B1C メッセージ定義を追加  
  - Table A23：BDS-3 B2a メッセージ定義を追加  
  - Table A24：BDS-3 B2b メッセージ定義を追加  

- **QZSS 用 CNAV メッセージ**  
  - Table A18：QZSS CNAV メッセージ定義を追加  
  - Table A19：QZSS CNAV-2 メッセージ定義を追加  

- **新規メッセージレコード（付録）**  
  - Table A30／A31／A32／A33／A34：STO（時刻オフセット）、EOP（地球回転偏差）、ION（電離層）メッセージのレコード記述を追加  

- **仕様書本文の追加**  
  - セクション 5.4.9：STO（時刻オフセット補正）メッセージの説明を追加  
  - セクション 5.4.10：EOP（地球回転パラメータ）メッセージの説明を追加  
  - セクション 5.4.11：ION（電離層パラメータ）メッセージの説明を追加  

- **ヘッダーの拡張**  
  - Table A7 にオプション行 `REC # / TYPE / VERS` を追加（基準局ナビゲーションファイル向け）  

---

### 観測ファイル内の変更

- **Table A2**  
  - ヘッダー中の `SYS / PHASE SHIFT` 行をオプション化  
- **GLONASS コード・位相整合**  
  - セクション 5.2.16 および Table A2 の `GLONASS COD/PHS/BIS` 行の必須条件を削除  
- **QZSS 新信号 L1 C/B**  
  - Table 14 に観測コード `C1E, L1E, D1E, S1E` を追加  
  - Table A39 において、L1 C/A 非対応時の参照信号として `L1 C/B` を定義  
- **QZSS PRN 割り当て更新**  
  - Table 6 に L1 C/B 用 PRN を追加  


> **QZSS 新信号 L1 C/B について**
>
> - **概要**  
>   - **周波数**：1575.42 MHz（L1帯）  
>   - **変調方式**：BOC(1,1)  
>   - **互換性**：GPS L1C、Galileo E1 OS と互換  
>   - **配信開始**：みちびき6号機（QZS-6）に合わせて2025年7月18日より衛星測位サービスでL1 C/Bを開始
> 
> - **L1 C/A との排他性**  
>   - L1 C/A 信号と L1 C/B 信号は排他的に送信され、同一衛星が同時に両方を放送することはありません
> 
> - **RINEX 4.00 における観測コード**  
>   - `C1E`：擬似距離測定  
>   - `L1E`：搬送波位相測定  
>   - `D1E`：ドップラー（周波数）測定  
>   - `S1E`：信号強度  
>   - これらは仕様書の Table 14 で定義されています
> 
> - **PRN 割り当て**  
>   - RINEX 4.00 の Table 6 に L1 C/B 用 PRN が追加されました  
>   - 例として、みちびき6号機の L1 C/B は PRN 205 に割り当てられています
> 
> - **信号認証サービス対応**  
>   - QZSS の信号認証サービスでは、L1 C/B 信号にも電子署名（信号認証データ）を埋め込んで配信します

---

### 全ファイルでの変更

- **FAIR データ原則対応の自由テキスト行を追加**  
  - `DOI`（Digital Object Identifier）  
  - `LICENSE OF USE`（データ利用ライセンス）  
  - `STATION INFORMATION`（局サイトメタデータへのリンク）  





## 2 RINEX の理念と歴史

受信機非依存交換フォーマット（RINEX: Receiver Independent Exchange Format）の最初の提案は、ベルン大学天文研究所によって行われました。これは、4 つの異なるメーカー製の 60 台以上の GPS 受信機を用いて実施された、最初の大規模な欧州 GPS キャンペーン “EUREF 89” で収集された GPS データを容易に交換するためのものでした。開発にあたって最大の焦点となったのは、以下の事実です。

多くの測地学的 GNSS データ処理ソフトウェアは、以下の限られた一連の観測量のみを使用することを前提としています：

- **搬送波位相観測**  
  衛星から受信した搬送波と受信機内生成基準周波数とのビート周波数を測定したもの  
- **擬似距離（コード）観測**  
  受信時刻（受信機の時系）と送信時刻（衛星の時系）の差として表される  
- **ドップラー観測**  
  受信搬送波周波数と衛星送信周波数との差  
- **信号対雑音比（SNR）観測**  
  キャリア対雑音密度比（C/N₀）または受信信号電力と雑音電力の比  
- **観測時刻**  
  各観測値が有効とされた瞬間における受信機時計の読み  

通常、RINEX ファイル中の観測時刻は、すべての観測値および観測衛星に共通で有効であると仮定されます。そのため、これらのソフトウェアは、受信機が内部的に保持する多くの情報を必要とせず、最小限として「位相」「コード」「時刻」と、局名、アンテナ高、アンテナモデルなどの局情報のみを利用します。

これまでに開発・公開された RINEX の主なメジャーバージョンは以下の通りです：

- **RINEX Version 1** （1989年）  
  第5回国際衛星測位測地シンポジウム（Las Cruces, 1989）で発表・承認  
- **RINEX Version 2** （1990年）  
  第2回精密 GPS 測位シンポジウム（Ottawa, 1990）で発表・承認。GLONASS や SBAS など他 GNSS の追跡データを含める機能を追加  
- **RINEX Version 3** （2000年代初頭）  
  マルチ GNSS をサポートし、各観測の追跡モードを 3 文字コードで明確に識別  
- **RINEX Version 4** （2021年）  
  各衛星のナビゲーションメッセージ、コンステレーション共通パラメータ、グローバルパラメータなどを格納する “データレコード” を定義し、現代のマルチ GNSS ナビゲーションメッセージをサポート  

---

### RINEX Version 2 のサブバージョン

- **2.10**  
  整数秒以外のサンプリングレート許可、生の信号強度を新たな観測量として追加（2002年）  
- **2.11**  
  L2C 擬似距離用の 2 文字観測コード定義、GEO NAV MESS ファイルの一部修正（2005年）※最後の公式版  
- **2.20**  
  IGS LEO パイロットプロジェクトの宇宙機受信機データ交換用の非公式版（2002年）  

2000年代初頭、新たな GNSS コンステレーション（BeiDou、Galileo、QZSS など）や、近代化された GPS/GLONASS の新周波数・観測タイプを効率的に扱うには、RINEX 2 の拡張性が不十分であることが明らかになりました。特に、複数チャネルでの周波数追跡を可能にするため、より柔軟かつ詳細な観測コード定義が求められました。

---

### RINEX Version 3 のサブバージョン

- **3.00**（2007年）  
  マルチ GNSS 観測データを完全にサポート。RINEX 2.20 の宇宙機受信機定義を組み込み  
- **3.01**（2009年）  
  異なる追跡モード間で一貫した位相観測を生成するため、必要に応じて¼周期シフトを適用  
- **3.02**（2013年）  
  QZSS サポート、BeiDou に関する追加情報、GLONASS コード位相バイアス列挙メッセージを追加  
- **3.03**（2015年）  
  NavIC/IRNSS サポートの追加、BeiDou B1 信号規約の修正、GPS/QZSS のフィット間隔フラグ仕様の明確化など  
- **3.04**（2018年）  
  GLONASS、QZSS、BeiDou の信号テーブルに関する補足説明と小規模修正  
- **3.05**（2020年）  
  文書の大規模改訂・再構成、BDS-2/BDS-3 完全サポート、GLONASS ナビメッセージの欠落フラグ・値を追加  

---

### RINEX Version 4 の誕生

2021年、DLR/GSOC（O. Montenbruck 博士ら）を中心とした大規模な取り組みにより、GNSS ナビゲーションメッセージフォーマットの近代化が進められました。各 GNSS ICD を分析し、既存フォーマットで未対応だったメッセージ要素を抽出・定義。各ベンダーの生ナビゲーションデータや内部バイナリフォーマットを解析し、RINEX ワーキンググループのナビゲーションタスクフォースでの議論資料を作成することで、バージョン 4 の大部分が形作られました。全 GNSS コミュニティから高い評価を受けています。





## 3 一般フォーマットの説明

RINEX 4 フォーマットは、以下の 3 種類の ASCII ファイルで構成されています。

1. 観測データファイル（Observation data file）  
2. ナビゲーションメッセージファイル（Navigation message file）  
3. 気象データファイル（Meteorological data file）  

> **電子基準点データ提供サービスで配布されているRINEXファイル（3.02）の各ファイルとの対応**
>
> - 観測データファイル（Observation data file）：oファイル
> - ナビゲーションメッセージファイル（Navigation message file）：Nファイル
> - 気象データファイル（Meteorological data file）：aファイル

---

### ファイル構成

各ファイルは **ヘッダーセクション** と **データセクション** の二つの部分から成ります。

- **ヘッダーセクション**  
  - ファイル全体に関するグローバル情報を含み、ファイル冒頭に配置されます。  
  - 各行の列 61–80 に「ヘッダーラベル」を記述します。これらのラベルは必須で、仕様書や例に示されたとおり厳密に記述しなければなりません。  
  - ヘッダーの長さに上限はなく、多くのラベルは用途に応じて任意です。自由にコメントを追加できます。  

- **データセクション**  
  - 観測データやナビゲーションメッセージ、気象データを記録します。  
  - 可変長レコードを許容するシステムでは、不要な空白を削除して可能な限り短く保つことができます。  
  - 観測レコードに対する最大レコード長の制限はありません。  

---

### フォーマット最適化のポイント

- ヘッダーに「この観測セッションで記録する観測種別」と「観測した衛星システム」を明示することで、受信機や衛星システムごとに観測種別が異なっても、不要な空白を省いて最小限のファイルサイズを実現しています。  

---

### ファイルの利用上の注意

- **観測データファイル** および **気象データファイル** は、基本的に「１局点」「１セッション分」のデータを格納します。  
- 仕様上はヘッダー行をデータセクション中に挿入することも可能ですが、時間が重複しない場合でも複数受信機（またはアンテナ）のデータを同一ファイルに連結することは推奨されません。  
- 複数受信機のデータを交換する必要がある場合は、同じナビゲーションメッセージを何度も繰り返すのは非効率です。  
  - そのため、ある受信機から取得したナビゲーションメッセージファイルを交換するか、または「複数受信機から集めた重複のない情報をまとめた合成ナビゲーションファイル」を作成して利用します。  

---

### 混合ナビゲーションメッセージファイル

RINEX 4 では、異なる衛星システムのナビゲーションメッセージをひとつのファイルに混在させることが想定されており、これによりナビゲーションデータの交換・処理効率が向上します。  

---

### 付録参照

各ファイルタイプのヘッダー・データレコード形式の詳細説明および記述例は、文書末尾のセクション 8（付録表）をご覧ください。  






## 4 基本的定義

GNSS 観測量には、定義が必要な以下の 3 つの基本量が含まれます：  
**時刻 (Time)**、**位相 (Phase)**、**距離 (Range)**

---

### 4.1 時刻 (Time)

観測の時刻は、受信機が受信した信号の受信時刻（受信機時刻）です。この時刻は、搬送波位相、擬似距離、ドップラーなどすべての観測量に対して同一とみなされ、そのエポックで観測されたすべての衛星に共通であるとみなされます。

- **単一システムファイル**  
  各衛星システム固有のシステム時刻で表記されます（デフォルト設定）。  
- **混合システムファイル**  
  実際に用いたシステム時刻は、ヘッダー中の `TIME OF FIRST OBS` レコード（Table A2）で明示する必要があります。

各 GNSS はそれぞれ独自のシステム時刻を持ち、UTC とは切り離されていますが、各システムの ICD（インターフェース仕様書）で指定された UTC 系列に同期・リンクされています。以下では、RINEX での各システム時刻の扱いを定義します。

#### 4.1.1 GPS 時刻

- UTC(USNO)（米海軍天文台版 UTC）に同期されているが、うるう秒は挿入しない連続時刻スケール  
- 表記は「GPS週」と「GPS週内秒数」で行い、1980年1月6日00:00:00 UTC を週ゼロとする  
- 衛星放送の GPS 週番号は 10 ビットで、1023 週後にロールオーバー  
  - 初回ロールオーバー：1999年8月22日00:00:00 GPS 時刻  
- RINEX ナビゲーションファイルではロールオーバーを避けるため、連続した週番号（…1023, 1024, 1025…）を用いる  
- **システム時刻識別子**：`GPS`

#### 4.1.2 GLONASS 時刻

- UTC(SU)（ソビエト／ロシア版 UTC）にリンクされるが、うるう秒を導入する連続でない時刻スケール  
- 放送時刻は UTC と同じ時刻帯（UTC+0）で表示  
- **システム時刻識別子**：`GLO`

#### 4.1.3 Galileo システム時刻 (GST)

- ヨーロッパ各機関の計測時計アンサンブルから得られる UTC 系列に同期  
- GPS 時刻とほぼ同一（ナノ秒オーダーの差異）  
- 「Galileo 週」は土曜夜～日曜深夜 00:00:00 に始まり、放送値は 12 ビット（4095 週後にロールオーバー）  
  - 週ゼロ開始：1999年8月22日00:00:00 GPS 時刻（GPS 第1回ロールオーバー時刻）  
- RINEX ではロールオーバーなしの連続週番号（…4095, 4096, 4097…）を用い、GPS週と整合  
- **システム時刻識別子**：`GAL`

#### 4.1.4 BeiDou 時刻 (BDT)

- UTC(NTSC)（中国国家標準時）に同期する連続時刻スケール  
- 2006年1月1日00:00:00 UTC を週ゼロ開始（GPS週 1356 に相当）、GPS 時刻より 14 秒遅延  
- 衛星放送の週番号は 13 ビット（8191 週後にロールオーバー）  
- RINEX では連続週番号（…8191, 8192, 8193…）を用いる  
- **システム時刻識別子**：`BDT`

#### 4.1.5 QZSS 時刻

- UTC(NICT)（情報通信研究機構版 UTC）に同期  
- GPS 時刻と整合（TAI からのオフセットは整数秒）  
- 週番号は GPS 週に合わせて定義  
- **システム時刻識別子**：`QZS`

#### 4.1.6 NavIC/IRNSS 時刻

- UTC(NPLI)（インド標準時）に同期する IRNSS 時刻スケール  
- 1999年8月22日00:00:00 IRNSST を週ゼロ開始（同時刻は UTC 1999年8月21日23:59:47）  
- 週番号は GPS/QZSS 同様に 1023 週後にロールオーバー  
- **システム時刻識別子**：`IRN`


### 4.1.7 GNSS 時刻間の関係

異なる GNSS システム時刻の実装にはサブマイクロ秒オーダーの小さな差がありますが、各システム時刻は UTC および他のシステム時刻と整数秒単位でずれています。各時刻スケール間の関係は以下の表にまとめられています。

また、現行のうるう秒数をヘッダーに含めるには、RINEX 観測ファイルのヘッダー（Table A2）に  `ΔtLS    ：LEAP SECONDS`行を追加することを推奨します。  
RINEX ナビゲーションファイルのヘッダー（Table A7）では、この LEAP SECONDS 行が必須となりました。  

さらに、マルチ GNSS RINEX ファイル（GPS/GLONASS/Galileo/QZSS/BDS/NavIC）では、すべての擬似距離観測が**同一の受信機時計**を基準としている必要があります。

#### Table 1 : コンステレーション時刻関係

| 関係式 |
|:-------------------------------|
| GLO = UTC = GPS − ΔtLS         |
| GPS = GAL = UTC + ΔtLS         |
| GPS = QZS = UTC + ΔtLS         |
| GPS = IRN = UTC + ΔtLS         |
| BDT = UTC + ΔtLS<sub>BDS</sub> |

#### Table 2 : GPS と BeiDou の UTC うるう秒関係

##### GPS と UTC の ΔtLS

| 期間                           | ΔtLS (秒) |
|:------------------------------|:----------|
| 1999-01-01 ～ 2006-01-01       | 13        |
| 2006-01-01 ～ 2009-01-01       | 14        |
| 2009-01-01 ～ 2012-07-01       | 15        |
| 2012-07-01 ～ 2015-07-01       | 16        |
| 2015-07-01 ～ 2017-01-01       | 17        |
| 2017-01-01 ～ ????-??-??       | 18        |

##### BeiDou (BDT) と UTC の ΔtLS<sub>BDS</sub>

- ΔtLS<sub>BDS</sub> は ΔtLS − 14 秒

| 期間                           | ΔtLS<sub>BDS</sub> (秒) |
|:------------------------------|:-------------------------|
| 2006-01-01 ～ 2009-01-01       | 0                        |
| 2009-01-01 ～ 2012-07-01       | 1                        |
| 2012-07-01 ～ 2015-07-01       | 2                        |
| 2015-07-01 ～ 2017-01-01       | 3                        |
| 2017-01-01 ～ ????-??-??       | 4                        |

既知でないバイアス（小さな差、1 秒未満）は、RINEX 変換前ではなく **後処理** 時に解決する必要があります。BDS、Galileo、GLONASS、UTC(SU)、UTC(USNO)、GPS 各時刻間の微小差も、同様に後処理で補正してください。  





#### 4.1.8 GNSS 週番号

GNSSサービスの開始時からの週番号の利用は、一般的な時刻参照手法です。  
異なるGNSS週番号間の対応関係は表 3に示すとおりです。 

**表 3：RINEX と GPS、QZSS、NavIC、GST、GAL、BDS の週番号対応**  
| コンステレーション／アーカイブ時刻表現               | 期間 #1      | 期間 #2        | 期間 #3        | 期間 #4        | 期間 #5      | 期間 #6      |
| ---------------------------------------------------- | ------------ | -------------- | -------------- | -------------- | ------------ | ------------ |

（※ 正確に出力できなかったため省略）


## 4.2 擬似距離 (Pseudorange)

擬似距離 (PR) は、受信機アンテナから衛星アンテナまでの距離に、受信機および衛星クロックオフセット（大気遅延などのその他バイアスを含む）を加えたもので、受信機と衛星のクロック挙動を反映します：  

```txt
PR = distance + c * (receiver clock offset – satellite clock offset) + other biases
```

ここで c = 299 792 458 m/s は光速を示し、擬似距離はメートル単位で格納されます 。

混合モード（GPS/GLONASS/Galileo/QZSS/BDS）受信機では、すべての擬似距離観測が同一の受信機クロックを基準としなければなりません。また、観測データ中の擬似距離からうるう秒の影響を除去するため、受信機の追跡時刻に応じて以下のように補正を行います （Table 4参照） 。

#### 表 4：コンステレーション別擬似距離補正

| コンステレーション | 受信機クロック時刻系                         | 補正後擬似距離 \(PR_{\mathrm{mod}}\)                                 |
|:-------------------|:---------------------------------------------|:------------------------------------------------------------------|
| GPS                | GLONASS 時刻系                              | \(PR(GPS) + c\cdot \Delta t_{LS}\)                                |
| GAL (Galileo)      | GLONASS 時刻系                              | \(PR(GAL) + c\cdot \Delta t_{LS}\)                                |
| BDT (BeiDou)       | GLONASS 時刻系                              | \(PR(BDT) + c\cdot \Delta t_{LS\,BDS}\)                           |
| GLO (GLONASS)      | GPS または GAL 時刻系                        | \(PR(GLO) - c\cdot \Delta t_{LS}\)                                |
| GLO (GLONASS)      | BDT 時刻系                                  | \(PR(GLO) - c\cdot \Delta t_{LS\,BDS}\)                          |
| GPS                | BDT 時刻系                                  | \(PR(GPS) + c\cdot(\Delta t_{LS} - \Delta t_{LS\,BDS})\)         |

- \(\Delta t_{LS}\) は GPS/GAL 時刻と GLONASS 時刻間の実際のうるう秒数（各ナビゲーションメッセージおよび BIPM Circular T で配布）  
- \(\Delta t_{LS\,BDS}\) は BDT 時刻と UTC 時刻間の実際のうるう秒数（BeiDou ナビゲーションメッセージで配信）   




## 4.3 位相 (Phase)

RINEX ファイルに提供される位相観測量は、アンテナから衛星までの搬送波位相信号を整数サイクル単位で測定したものです。スクウェア型受信機による半サイクル測定値は、整数サイクルに変換し、対応する観測コードでフラグを立てなければなりません（詳細はセクション 5.2.13参照） 。

位相は擬似距離と同様、時間とともに増加または減少し、エポック間の観測値は整数サイクル分をつなげて一貫性を保ちます。必要に応じて、Table A39 に示す参照信号に合わせた位相シフト補正を行い、同一周波数・同一システム内の異なる信号チャネル間で位相を揃えます 。

受信機または変換ソフトウェアがリアルタイムで算出した受信機時計オフセット dT(r) を用いて観測値を補正する場合は、位相／擬似距離／エポックの一貫性を維持する必要があり、以下のようにすべての観測量に対して受信機時計補正を適用します 。

| 観測量             | 補正式                                      |
|-------------------|--------------------------------------------|
| 時刻 (corr)       | Time(r) − dT(r)                            |
| 擬似距離 (corr)   | PR(r) − dT(r) × c                          |
| 位相 (corr)       | phase(r) − dT(r) × freq                    |
| ドップラー (corr) | Doppler(r) − dṪ(r) × freq                  |

---

## 4.4 ドップラー (Doppler)

ドップラーシフト観測量の符号は従来通り、衛星が受信機に近づく場合を「正」と定義します 。



