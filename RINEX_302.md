# RINEX 3.02

## 1. RINEX の理念と歴史

Receiver Independent Exchange Format（RINEX）の最初の提案は、EUREF 89 大規模 GPS キャンペーン（60台以上の異なるメーカー製受信機参加）で収集される GPS データを容易に交換できるよう、ベルン大学天文研究所により開発されました。開発時の最大の配慮点は以下の通りです。

ほとんどの測地処理ソフトウェアが共通して利用する観測値は、

  - 搬送波のキャリア位相観測（受信した衛星信号搬送波と受信機生成リファレンス周波数のビート周波数測定）
  - 擬似距離（コード）観測（受信時刻〔受信機時刻系〕と送信時刻〔衛星時刻系〕の差）
  - 観測時刻（上記キャリア位相またはコード観測が有効となった受信機クロックの読み値）

通常、観測時刻は位相・コード観測の双方および全衛星に共通と仮定されるため、ソフトウェアが必要とする受信機情報は「位相・コード・観測時刻」と局名やアンテナ高などの局情報だけで十分でした。

これまでに開発・公開された主なフォーマットは以下です。

- **RINEX Version 1**  
   - 1989年に第5回国際測地衛星測位シンポジウム（ラスクルーセス）で発表・承認
- **RINEX Version 2**  
   - 1990年に第二回精密測位シンポジウム（オタワ）で発表。GLONASSやSBASの追跡データを含める機能を追加
   - **Version 2.10**: 非整数秒サンプリング対応＋生信号強度観測追加
   - **Version 2.11**: L2C擬似距離用2文字コード定義＋GEO NAV MESS修正
   - **Version 2.20**: IGS LEOパイロット向け非公式版

また、RINEX の考え方を応用した IGS 向け交換フォーマットも策定されています。

- 衛星／受信機クロックオフセット交換フォーマット
- SBAS 放送データ交換フォーマット
- IONEX（電離圏モデル交換フォーマット）
- ANTEX（測地用GNSSアンテナ位相中心変位交換フォーマット）

将来の Galileo や拡張GPS（新周波数・観測型、多チャネル追跡）への対応強化、および複数衛星システム混在ファイルの取り扱い改善を目的として、データレコード構造を大幅に改訂し80文字制限を撤廃した **RINEX Version 3** が策定されました。  
さらに **Version 3.01** では、異なる追跡モード／チャネル間で位相整合を図るために必要に応じ1/4サイクルシフトを適用できる仕様が追加されています。





## 2. 一般フォーマットの説明

RINEX バージョン 3.00 形式は、以下の３種類の ASCII ファイルで構成されています

1. **観測データファイル（Observation data File）**  
2. **ナビゲーションメッセージファイル（Navigation message File）**  
3. **気象データファイル（Meteorological data File）**  

各ファイルは「**ヘッダセクション**」と「**データセクション**」から成り、ヘッダセクションはファイルの先頭に配置されます。  
ヘッダセクション内の各行では、**61～80 文字目**にヘッダラベルを置き、仕様書に示されたとおり正確に記述することが必須です。

フォーマットは、受信機や衛星システムごとの観測型の数に依存せずにファイルサイズを最小化できるよう設計されています。  
ヘッダで「格納する観測型」と「観測された衛星システム」を指定することで、可変長レコードを許すシステムでは観測レコードを必要最小限に短く保ち、末尾の空白を省略できます。  
観測レコードに最大長制限はありません。

観測データファイルおよび気象データファイルは基本的に「１局・１セッション分」のデータを含みます。RINEX バージョン 2 以降では、ローミング受信機が複数の局を順次占有するケース（ラピッドスタティックやキネマティック測位）にも対応可能ですが、異なる受信機（またはアンテナ）のデータを同一ファイルに連結することは推奨されません。

複数の受信機データを交換する場合、同一衛星のナビゲーションメッセージを重複して含めるのは非効率です。そこで、ある受信機から取得したナビゲーションメッセージファイルを交換するか、複数受信機の情報を統合して冗長性のないメッセージファイルを作成する方法が推奨されます。

RINEX バージョン 1 のナビゲーションメッセージファイル形式は旧 NGS 交換フォーマットと同一でしたが、バージョン 3 では GPS、GLONASS、Galileo、準天頂衛星システム（QZSS）、北斗（BDS）、SBAS の複数システムのメッセージを同一ファイルに含めることができます。

各データレコードの詳細なフォーマット説明および例は、ドキュメント末尾の付録表に掲載されています。


> **「観測型」って何？**
> 
> RINEX 3.02 における **観測型（observation types）** とは、ファイルに含める各種観測データの種類を示す **3文字のコード**を指します。  
> これらのコードは、ヘッダの **`SYS / # / OBS TYPES`** レコードで列挙される。  
>
> 具体例：  
>   - `C1C`, `L1C`, `D1C`, `S1C` ： L1 信号の各観測値
>       - `C1C` ： L1 周波数の **コード擬似距離** 
>       - `L1C` ： L1 周波数の **キャリア位相**  
>       - `D1C` ： L1 周波数の **ドップラー**  
>       - `S1C` ： L1 周波数の **信号強度** 
>   - `C2X`, `L2X`, `D2X`, `S2X` ： L2 信号の各観測値  
>   - `C5X`, `L5X`, `D5X`, `S5X` ： L5 信号の各観測値  
> 
> 各コードは以下の３要素で構成されます
>
> 1. **t（type）**：観測量の種類  
> 2. **n（number: 周波数番号）**：1=L1, 2=L2, 5=L5, …  
> 3. **a（attribute: 属性）**：チャネルや信号生成モード（C/A コード由来なら `C`，複数チャネル混合なら `X` など）  
> 
> これにより、ヘッダで定義した観測型の順序どおりに各エポック・各衛星のデータレコードが並びます





## 3. 基本定義

GPS の観測値には、定義すべき三つの基本量が含まれます

- 時刻 (Time)
- 距離 (Range)
- 位相 (Phase)

### 3.1 時刻 (Time)  

観測時刻は、受信信号を受信したときの受信機時刻です

- 位相観測と擬似距離観測の両方で同一の時刻を用います  
- 同一エポック内の全衛星に対して同一の時刻です
- 単一システムのファイルでは、デフォルトで該当衛星システムの時刻系が使用されます
- 混合システムのファイルでは、必ずヘッダの **Start Time** レコードで実際の時刻を指定する必要があります

### 3.2 擬似距離 (Pseudo-Range)  
擬似距離 (PR) とは、受信機アンテナから衛星アンテナまでの **幾何距離（distance）** に、**受信機および衛星の時計オフセット（receiver clock offset / satellite clock offset）** や **大気遅延などのバイアス（other biases）** を加えたものです。  

```text
PR = distance + c * (receiver clock offset – satellite clock offset + other biases)
```

ここで c は光速（m/s）を表します。　※ つまり定数？  
この式により、擬似距離（PR）は受信機・衛星のクロック挙動を反映します。  
ファイル中ではメートル単位で格納されます。

混合 GPS/GLONASS/Galileo/QZSS/BDS ファイルにおける擬似距離の取り扱いについては、第 8.1 章をご参照ください。





### 3.3 位相 (Phase)

位相観測値は、搬送波位相（carrier-phase）を**全周サイクル数**で表したものです。  
スクエアリング型受信機が測定する**半サイクル**は、全周サイクル数に変換し、対応する観測コードでフラグを立てる必要があります（GPSのみ、Table 2および§5.4参照）。

位相の変化は擬似距離の変化と同符号（負のドップラー）です。  
隣接エポック間の位相観測は、**整数サイクル数**を足し合わせて継続性を保つ必要があります。

位相観測値には、大気屈折や衛星時計オフセットなどの**外部補正**は行われません。

必要に応じて、異なる信号チャネル間で同一周波数・同一衛星システムの位相を一致させる**位相シフト補正**を適用します（§9.1および付録A19参照）。

受信機または変換ソフトがリアルタイム算出の **受信機時計オフセット dT(r)** を用いて観測値を補正する場合、位相／擬似距離／エポックの３量の整合性を保つため、以下のようにすべての観測量に同じ時計補正 dT(r) を適用します。

  ```text
  Time (corr)  = Time(r)   – dT(r)
  PR   (corr) = PR(r)     – dT(r) × c
  phase (corr)= phase(r)  – dT(r) × freq
  ```

> (corr)：correctedの略、補正後の意味  
> (r)： receiverの略、受信機の意味  
> c：光速  
> freq：搬送波の周波数（L1, L2, L5 など）





### 3.4 ドップラー （Doppler）  
追加の観測量としてのドップラーシフトの符号は通常どおり定義され、**衛星が接近するときに正**となります。


### 3.5 衛星番号 （Satellite numbers）  
RINEX Version 2 以降では、従来の二桁番号 nn の前に「衛星システム識別子 s」1文字を付加した「S NN」で衛星を識別します。

衛星番号とコンステレーション識別子（S NN）：

- **S（システム識別子）**：  
    - G：GPS  
    - R：GLONASS  
    - S：SBAS ペイロード  
    - E：Galileo  
    - C：BeiDou  
    - J：QZSS 
- **NN**：  
    - GPS／Galileo／BeiDou　=>　PRN  
    - GLONASS　=>　スロット番号  
    - SBAS, QZSS (L1 – SAIF)　=>　PRN − 100  
    - QZSS (その他)　=>　PRN − 192  

同じシステム識別子は、ヘッダの各種レコード中でも必要に応じて用いられます。  


> 衛星番号フィールドは２桁の “NN” 部分に、元の衛星識別番号をうまく収めるためにシステムごとに異なる「オフセット引き算」を行っています。具体的には次のようなルールです。
>
> 	1. GPS／Galileo／BeiDou
> 	    - これらは元々の PRN 番号（1～32など）をそのまま “NN” に使います。
> 	    - 例：GPS の PRN 7 → G07
> 	2. GLONASS
> 	    - 衛星に付与された「スロット番号」（1～24）を “NN” に使います。
> 	    - 例：GLONASS のスロット 5 → R05
> 	3. SBAS と QZSS（L1-SAIF モード）
> 	    - SBAS（WAAS, EGNOS など）は PRN が 120～158 程度の 100 番台になります。
> 	    - QZSS の L1-SAIF も同様に 100 番台 PRN を使うため、二桁の NN に収めるには 100 を引く 形にします。
> 	    - たとえば PRN 120（SBAS）→ 120 − 100 = 20 → S20
> 	    - たとえば PRN 193（QZSS-SAIF）→ 193 − 100 = 93 → J93
> 	4. QZSS（その他モード）
> 	    - QZSS の通常モード（L1C, L2C, L5 など）は PRN が 192～198 番台になります。
> 	    - これも二桁にするために 192 を引く 形で NN を算出します。
> 	    - たとえば PRN 193 → 193 − 192 = 1 → J01
> 	    - たとえば PRN 196 → 196 − 192 = 4 → J04
> 
> こうすることで、どのシステムのどの衛星かを示しつつ、常に２桁の番号 sNN に収められるようになっています。


